<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok API Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #333; }
        section { margin-bottom: 40px; border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
        form { display: flex; flex-direction: column; }
        label { margin-top: 10px; }
        input, button { margin-top: 5px; padding: 8px; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        pre { background-color: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .response { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>TikTok API Manager</h1>
    <p>This page provides a simple interface to interact with your FastAPI endpoints for uploading videos and boosting accounts. Ensure the API is running on <code>http://localhost:8000</code> (or adjust the base URL in the script if different).</p>

    <section id="upload-section">
        <h2>Upload Module</h2>

        <form id="prepare-accounts-form">
            <label for="count">Number of Accounts to Prepare:</label>
            <input type="number" id="count" name="count" value="20" required>
            <button type="submit">Prepare Accounts</button>
        </form>
        <div class="response" id="prepare-accounts-response"></div>

        <form id="upload-videos-form">
            <label for="videos">Upload Videos (multiple files):</label>
            <input type="file" id="videos" name="files" multiple required accept="video/*">
            <button type="submit">Upload Videos</button>
        </form>
        <div class="response" id="upload-videos-response"></div>

        <form id="upload-titles-form">
            <label for="titles">Upload Titles File (.txt):</label>
            <input type="file" id="titles" name="file" required accept=".txt">
            <button type="submit">Upload Titles</button>
        </form>
        <div class="response" id="upload-titles-response"></div>

        <form id="prepare-config-form">
            <label for="music_name">Music Name:</label>
            <input type="text" id="music_name" name="music_name">

            <label for="location">Location:</label>
            <input type="text" id="location" name="location">

            <label for="mentions">Mentions (comma-separated):</label>
            <input type="text" id="mentions" name="mentions" placeholder="user1,user2">

            <label for="upload_cycles">Upload Cycles:</label>
            <input type="number" id="upload_cycles" name="upload_cycles" value="5" required>

            <button type="submit">Prepare Config</button>
        </form>
        <div class="response" id="prepare-config-response"></div>

        <form id="start-upload-form">
            <button type="submit">Start Upload</button>
        </form>
        <div class="response" id="start-upload-response"></div>
    </section>

    <section id="booster-section">
        <h2>Booster Module</h2>

        <form id="upload-accounts-form">
            <label for="accounts-file">Upload Accounts File (.txt):</label>
            <input type="file" id="accounts-file" name="file" required accept=".txt">
            <button type="submit">Upload Accounts</button>
        </form>
        <div class="response" id="upload-accounts-response"></div>

        <form id="upload-proxies-form">
            <label for="proxies-file">Upload Proxies File (.txt):</label>
            <input type="file" id="proxies-file" name="file" required accept=".txt">
            <button type="submit">Upload Proxies</button>
        </form>
        <div class="response" id="upload-proxies-response"></div>

        <form id="prepare-booster-accounts-form">
            <button type="submit">Prepare Booster Accounts</button>
        </form>
        <div class="response" id="prepare-booster-accounts-response"></div>

        <form id="start-booster-form">
            <button type="submit">Start Booster</button>
        </form>
        <div class="response" id="start-booster-response"></div>
    </section>

    <script>
        const API_BASE = 'http://localhost:8000'; // Change if your API runs on a different port/host

        async function handleFormSubmit(event, endpoint, method = 'POST', isFormData = false) {
            event.preventDefault();
            const form = event.target;
            let body;
            if (isFormData) {
                body = new FormData(form);
            } else {
                body = JSON.stringify(Object.fromEntries(new FormData(form)));
            }
            const responseElement = document.getElementById(`${form.id}-response`);
            try {
                const res = await fetch(`${API_BASE}${endpoint}`, {
                    method,
                    headers: isFormData ? {} : { 'Content-Type': 'application/json' },
                    body
                });
                const data = await res.json();
                responseElement.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                if (!res.ok) throw new Error(`Error: ${res.status}`);
            } catch (error) {
                responseElement.innerHTML = `<pre style="color: red;">${error.message}</pre>`;
            }
        }

        // Upload Module
        document.getElementById('prepare-accounts-form').addEventListener('submit', (e) => handleFormSubmit(e, '/upload/prepare_accounts'));
        document.getElementById('upload-videos-form').addEventListener('submit', (e) => handleFormSubmit(e, '/upload/upload_videos/', 'POST', true));
        document.getElementById('upload-titles-form').addEventListener('submit', (e) => handleFormSubmit(e, '/upload/upload_titles', 'POST', true));
        document.getElementById('prepare-config-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);

    // Преобразуем данные
    const mentions = formData.get('mentions')
        ? formData.get('mentions').split(',').map(m => m.trim()).filter(m => m)
        : [];

    const body = JSON.stringify({
        music_name: formData.get('music_name') || '',
        location: formData.get('location') || '',
        mentions: mentions,
        upload_cycles: parseInt(formData.get('upload_cycles') || 5) // Преобразуем в число
    });

    const responseElement = document.getElementById('prepare-config-response');

    try {
        const res = await fetch(`${API_BASE}/upload/prepare_config`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: body
        });

        if (!res.ok) {
            const error = await res.json();
            throw new Error(error.detail || `HTTP error ${res.status}`);
        }

        const data = await res.json();
        responseElement.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
    } catch (error) {
        responseElement.innerHTML = `<pre style="color: red;">${error.message}</pre>`;
    }
});
        document.getElementById('start-upload-form').addEventListener('submit', (e) => handleFormSubmit(e, '/upload/start_upload'));

        // Booster Module
        document.getElementById('upload-accounts-form').addEventListener('submit', (e) => handleFormSubmit(e, '/booster/upload_accounts', 'POST', true));
        document.getElementById('upload-proxies-form').addEventListener('submit', (e) => handleFormSubmit(e, '/booster/upload_proxies', 'POST', true));
        document.getElementById('prepare-booster-accounts-form').addEventListener('submit', (e) => handleFormSubmit(e, '/booster/prepare_accounts'));
        document.getElementById('start-booster-form').addEventListener('submit', (e) => handleFormSubmit(e, '/booster/start_booster'));
    </script>
</body>
</html>