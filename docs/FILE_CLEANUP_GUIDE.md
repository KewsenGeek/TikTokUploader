# üßπ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—á–∏—Å—Ç–∫–µ —Ñ–∞–π–ª–æ–≤

## üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –æ—á–∏—Å—Ç–∫–∏

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `media/bot/bulk_videos/` –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ.

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∏

### ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∑–∞—â–∏—Ç—ã:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á** - —Ñ–∞–π–ª—ã –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞–¥–∞—á–∞–º–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `RUNNING` –∏–ª–∏ `PENDING`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏** - —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ
3. **Graceful handling** - –µ—Å–ª–∏ —Ñ–∞–π–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –æ–Ω –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º

### üìù –ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—á–∏—Å—Ç–∫–∞:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ bulk upload –∑–∞–¥–∞—á–∏ (—Å—Ç–∞—Ç—É—Å `COMPLETED`/`FAILED`/`PARTIALLY_COMPLETED`)
2. **–í—Ä—É—á–Ω—É—é** - —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç `cleanup_media_files.py`

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –æ—á–∏—Å—Ç–∫–∏

### –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
```bash
python3 cleanup_media_files.py --stats
```

### –û—á–∏—Å—Ç–∏—Ç—å orphaned —Ñ–∞–π–ª—ã:
```bash
python3 cleanup_media_files.py --orphaned
```

### –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á (7+ –¥–Ω–µ–π):
```bash
python3 cleanup_media_files.py --old-tasks 7
```

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:
```bash
python3 cleanup_media_files.py --all
```

## üè• –õ–æ–≥–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
def is_file_safe_to_delete():
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥—Ä—É–≥–∏–µ BulkVideo —Å —Ç–µ–º –∂–µ —Ñ–∞–π–ª–æ–º
    other_videos = BulkVideo.objects.filter(video_file__icontains=filename)
    
    # 2. –ò—Å–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É
    other_videos = other_videos.exclude(bulk_task=current_task)
    
    # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å—ã —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
    for video in other_videos:
        if video.bulk_task.status in ['RUNNING', 'PENDING']:
            return False  # ‚ùå –ù–ï –ë–ï–ó–û–ü–ê–°–ù–û
    
    return True  # ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û
```

## üìä –ß—Ç–æ –ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è:

- ‚ùå –§–∞–π–ª—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á (`RUNNING`, `PENDING`)
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏ (–æ–Ω–∏ –≤ `/tmp/`)
- ‚ùå –§–∞–π–ª—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏

## üìä –ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è:

- ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ Orphaned —Ñ–∞–π–ª—ã (–±–µ–∑ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î)
- ‚úÖ –§–∞–π–ª—ã —Å—Ç–∞—Ä—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

## üö® –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º:

1. **–§–∞–π–ª —É–¥–∞–ª–∏–ª—Å—è –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
2. **–ú–µ—Å—Ç–æ –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è** - –∑–∞–ø—É—Å—Ç–∏—Ç–µ `--stats` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. **–û—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ `media/`

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ `--stats` —Ä–µ–≥—É–ª—è—Ä–Ω–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--old-tasks 7` –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á 