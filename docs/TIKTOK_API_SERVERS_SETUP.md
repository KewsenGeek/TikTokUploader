# Настройка нескольких TikTok API серверов

Этот документ описывает как настроить несколько API серверов для TikTok Booster с возможностью выбора сервера через веб-интерфейс.

## Быстрый старт

### Вариант 1: Простая настройка (один сервер)

Добавьте в ваш `.env` файл:

```bash
TIKTOK_API_BASE=http://94.141.161.231:8000
```

### Вариант 2: Несколько серверов с выбором

Добавьте в ваш `.env` файл:

```bash
TIKTOK_API_SERVERS=[
  {
    "name": "Primary Server",
    "url": "http://94.141.161.231:8000",
    "description": "Основной сервер для TikTok API"
  },
  {
    "name": "Secondary Server",
    "url": "http://94.141.161.232:8000",
    "description": "Резервный сервер для TikTok API"
  },
  {
    "name": "Local Development",
    "url": "http://localhost:8000",
    "description": "Локальный сервер для разработки"
  }
]
```

## Как это работает

1. **TIKTOK_API_BASE** - приоритетная настройка, переопределяет список серверов
2. **TIKTOK_API_SERVERS** - JSON массив с конфигурацией серверов
3. Если `TIKTOK_API_BASE` не указан, используется первый сервер из списка

## Примеры конфигураций

### Для разработки

```bash
TIKTOK_API_SERVERS=[
  {
    "name": "Local Development",
    "url": "http://localhost:8000",
    "description": "Локальный сервер для разработки"
  }
]
```

### Для продакшн с балансировкой нагрузки

```bash
TIKTOK_API_SERVERS=[
  {
    "name": "Load Balancer 1",
    "url": "http://lb1.yourdomain.com:8000",
    "description": "Первый балансировщик нагрузки"
  },
  {
    "name": "Load Balancer 2",
    "url": "http://lb2.yourdomain.com:8000",
    "description": "Второй балансировщик нагрузки"
  }
]
```

### Географически распределенные серверы

```bash
TIKTOK_API_SERVERS=[
  {
    "name": "Europe (Frankfurt)",
    "url": "http://eu-central-1.api.tiktok.com:8000",
    "description": "Европейский датацентр"
  },
  {
    "name": "North America (Virginia)",
    "url": "http://us-east-1.api.tiktok.com:8000",
    "description": "Североамериканский датацентр"
  },
  {
    "name": "Asia Pacific (Tokyo)",
    "url": "http://ap-northeast-1.api.tiktok.com:8000",
    "description": "Азиатско-Тихоокеанский датацентр"
  }
]
```

## Использование веб-интерфейса

1. Перейдите на страницу `/tiktok/booster/`
2. В правом верхнем углу найдите выпадающий список "API Server"
3. Выберите нужный сервер
4. Система автоматически переключится на выбранный сервер
5. Статус подключения обновится автоматически

## Дополнительные настройки

### Таймауты подключения

```bash
# Время ожидания подключения (миллисекунды)
TIKTOK_API_TIMEOUT=5000

# Количество повторных попыток
TIKTOK_API_RETRY_ATTEMPTS=3

# Интервал между попытками (миллисекунды)
TIKTOK_API_RETRY_DELAY=1000
```

### Принудительный выбор сервера

```bash
# Всегда использовать конкретный сервер, игнорируя список
TIKTOK_API_BASE=http://your-specific-server.com:8000
```

## Мониторинг и отладка

Логи переключения серверов доступны в:
- Веб-интерфейсе в разделе "System Logs"
- Консоли браузера (F12 → Console)
- Серверных логах Django

## Безопасность

- Используйте HTTPS в продакшн среде
- Ограничивайте доступ к API серверам по IP
- Регулярно обновляйте список серверов
- Мониторьте доступность всех серверов

## Troubleshooting

### Сервер не отображается в списке
- Проверьте JSON синтаксис в `TIKTOK_API_SERVERS`
- Убедитесь что сервер доступен по указанному URL
- Проверьте логи сервера на наличие ошибок

### Ошибка подключения
- Проверьте доступность сервера командой `curl http://your-server:8000/docs`
- Убедитесь что сервер запущен и работает
- Проверьте сетевые настройки и firewall

### Долгое переключение
- Увеличьте `TIKTOK_API_TIMEOUT` если сеть медленная
- Проверьте качество интернет соединения
- Убедитесь что сервер отвечает быстро
