{% extends "uploader/base.html" %}

{% block title %}Import Account Bundle - Instagram Uploader{% endblock %}

{% block extra_css %}
<style>
	.bundle-example { white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word; }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
	<div>
		<a href="{% url 'account_list' %}" class="text-decoration-none">
			<i class="bi bi-arrow-left"></i> Back to Accounts
		</a>
		<h2 class="mb-0 mt-2">Import Account Bundle</h2>
		<p class="text-muted mb-0">Формат: одна строка с секциями через <code>|</code>: креды, UA, device ids, cookies/headers, proxy</p>
	</div>
</div>

<div class="row">
	<div class="col-lg-10 mx-auto">
		<div class="card">
			<div class="card-header">
				<h5 class="mb-0"><i class="bi bi-file-earmark-arrow-up"></i> Upload Bundle File</h5>
			</div>
			<div class="card-body">
				<div class="alert alert-info">
					<div class="d-flex">
						<div class="me-3">
							<i class="bi bi-info-circle-fill fs-3"></i>
						</div>
						<div>
							<h6 class="alert-heading">Expected Format</h6>
							<p class="mb-2">Пример строки:</p>
							<pre class="small bg-light p-2 rounded overflow-auto bundle-example">login:pass:email:emailpass|Instagram 364.0.0.18.86 Android (..)|android-xxx;device_guid;phone_id;ad_id|Authorization=Bearer IGT:2:...; IG-U-DS-USER-ID=...; X-MID=...; ...|https:host:10000:proxyuser:proxypass</pre>

							<ul class="mb-0">
								<li><b>Creds</b>: <code>login:password[:email][:email_password]</code></li>
								<li><b>UA</b>: строка Instagram Android (необязательно)</li>
								<li><b>Device IDs</b>: <code>android-&lt;id&gt;;device_guid;phone_id;advertising_id</code> (необязательно)</li>
								<li><b>Cookies/headers</b>: <code>name=value; ...; Authorization=Bearer IGT:2:&lt;base64&gt;</code> (необязательно)</li>
								<li><b>Proxy</b>: <code>scheme:host:port:username:password</code> или <code>host:port:user:pass</code> (необязательно)</li>
							</ul>
						</div>
					</div>
				</div>

				<form method="post" enctype="multipart/form-data" class="mt-3">
					{% csrf_token %}
					<div class="mb-4">
						<label for="client_id" class="form-label">Assign to Client (optional)</label>
						<select class="form-select" id="client_id" name="client_id">
							<option value="">— Without client —</option>
							{% for c in clients %}
								<option value="{{ c.id }}">{{ c.name }} {% if c.agency %}(Agency: {{ c.agency.name }}){% endif %}</option>
							{% endfor %}
						</select>
						<div class="form-text">Импортируемые аккаунты будут привязаны к выбранному клиенту.</div>
					</div>
					<div class="mb-4">
						<label for="accounts_file" class="form-label">Bundle File</label>
						<input type="file" name="accounts_file" id="accounts_file" class="form-control" accept=".txt" required>
						<div class="form-text">Выберите текстовый файл с одной строкой на аккаунт</div>
					</div>

					<div class="d-grid gap-2">
						<button type="submit" class="btn btn-primary" id="submitBtn">
							<i class="bi bi-cloud-upload"></i> Import
						</button>
						<a href="{% url 'account_list' %}" class="btn btn-outline-secondary">
							<i class="bi bi-x"></i> Cancel
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
{% endblock %}


